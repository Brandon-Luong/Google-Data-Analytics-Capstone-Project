---
title: 'Google Data Analytics Capstone Project'
subtitle: 'Case Study 2: How Can a Wellness Technology Company Play It Smart?'
author: "Brandon Luong"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    number_sections: true
---
# Introduction

As part of the Google Data Analytics Program, I am tasked with completing a Capstone case study. I have chosen to do this project in R because the dataset file size is too large to comfortably work in spreadsheets (Excel/Google Sheets). This project can be done in SQL, but R has many handy packages such as tidyverse for data cleaning and analysis.

I am part of the marketing analytics team at Bellabeat, a high-tech manufacturer of health-focused products for women. Bellabeat is a small successful company but has the potential for growth in the global smart device market. Urška Sršen believes that analyzing smart fitness data could help with this growth and unlock new opportunities for the company.

Bellabeat Mission Statement: Empower women with knowledge about their own health and habits by collecting data on activity, sleep, stress, and reproductive health.

The Bellabeat Products:

- Bellabeat app: The Bellabeat app provides users with health data related to their activity, sleep, stress, menstrual cycle, and mindfulness habits. This data can help users better understand their current habits and make healthy decisions. The Bellabeat app connects to their line of smart wellness products.
- Leaf: Bellabeat’s classic wellness tracker can be worn as a bracelet, necklace, or clip. The Leaf tracker connects to the Bellabeat app to track activity, sleep, and stress.
- Time: This wellness watch combines the timeless look of a classic timepiece with smart technology to track user activity, sleep, and stress. The Time watch connects to the Bellabeat app to provide you with insights into your daily wellness.
- Spring: This is a water bottle that tracks daily water intake using smart technology to ensure that you are appropriately hydrated throughout the day. The Spring bottle connects to the Bellabeat app to track your hydration levels.

# Ask

Primary stakeholders:

- Urška Sršen: Cofounder and Chief Creative Officer
- Sando Mur: Cofounder and key member of the Bellabeat executive team

Secondary stakeholders:

- Bellabeat marketing analytics team: A team of data analysts responsible for collecting, analyzing, and reporting data that helps guide Bellabeat’s marketing strategy.

Main questions to answer in this analysis:

1. What are some trends in smart device usage?
2. How could these trends apply to Bellabeat customers?
3. How could these trends help influence Bellabeat marketing strategy?

Main deliverables (ie. objectives) to report:

1. A clear summary of the business task
2. A description of all data sources used
3. Documentation of any cleaning or manipulation of data
4. A summary of your analysis
5. Supporting visualizations and key findings
6. Your top high-level content recommendations based on your analysis

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

**1. A clear summary of the business task:**

Analyze smart device usage data for trends and insights and apply the new-found knowledge to one Bellabeat product, presenting high-level recommendations for how these trends can improve Bellabeat's marketing strategy.

</div>

# Prepare

Dataset:

- [Kaggle Fitbit Fitness Tracker Data](https://www.kaggle.com/arashnic/fitbit "Fitbit Fitness Tracker Data"), by Mobius

License:

- CC0: Public Domain

Storage:

- The data is originally stored in 18 csv files on Kaggle.
- It is then downloaded and stored locally on my computer for analysis.

## Load libraries

```{r Load libraries}
library(tidyverse) # General purpose data science package
library(janitor) # Data cleaning
library(lubridate) # Date parsing and cleaning
library(skimr) # Viewing
library(patchwork) # Plotting
library(scales) # Plotting
```

## Import csv files

```{r Import csv files, message=FALSE, warning=FALSE}
# Per Day
daily_act <- read_csv('dailyActivity_merged.csv') # Use
daily_cal <- read_csv('dailyCalories_merged.csv')
daily_intense <- read_csv('dailyIntensities_merged.csv')
daily_steps <- read_csv('dailySteps_merged.csv')
daily_sleep <- read_csv('sleepDay_merged.csv') # Use
# Per Hour
hourly_cal <-read_csv('hourlyCalories_merged.csv')
hourly_intense <- read_csv('hourlyIntensities_merged.csv')
hourly_steps <- read_csv('hourlySteps_merged.csv')
# Per Minute
min_cal_narrow <- read_csv('minuteCaloriesNarrow_merged.csv')
min_cal_wide <- read_csv('minuteCaloriesWide_merged.csv')
min_intense_narrow <- read_csv('minuteIntensitiesNarrow_merged.csv')
min_intense_wide <- read_csv('minuteIntensitiesWide_merged.csv')
min_steps_narrow <- read_csv('minuteStepsNarrow_merged.csv')
min_steps_wide <- read_csv('minuteStepsWide_merged.csv')
min_sleep <- read_csv('minuteSleep_merged.csv')
min_met_narrow <- read_csv('minuteMETsNarrow_merged.csv')
# Per Second
sec_heartrate <- read_csv('heartrate_seconds_merged.csv')
# Other
weight_log <- read_csv('weightLogInfo_merged.csv')
```

Assumptions:

- The data seems to be broken up into daily, hourly, per minute, per second, and other categories.
- Because I want to analyze general trends, I may want to just focus on the daily files for trends over the course of the month.
- I may drop the hourly, per minute, and per second files as they may capture such a small time interval per observation that it may not be useful for my particular analysis.
- Some files may just be repeats of the same data but in different formats (eg. daily_cal vs hourly_cal, min_intense_narrow vs min_intense_wide) so I may be able to just pick 1 and drop the others.

## Exploratory Data Analysis

Let's start with these 5 daily csv files:

- `daily_act`
- `daily_cal`
- `daily_intense`
- `daily_steps`
- `daily_sleep`

```{r daily_act head}
head(daily_act)
```
```{r daily_act column names}
colnames(daily_act)
```
```{r daily_cal head}
head(daily_cal)
```
```{r}
colnames(daily_cal)
```
```{r}
# Calculate the number of differing values in daily_cal
diff <- daily_cal
diff$Id <- ifelse(daily_act$Id != daily_cal$Id, 1, 0)
diff$ActivityDay <- ifelse(daily_act$ActivityDate != daily_cal$ActivityDay, 1, 0)
diff$Calories <- ifelse(daily_act$Calories != daily_cal$Calories, 1, 0)
colSums(diff)
```
```{r}
head(daily_intense)
```
```{r}
colnames(daily_intense)
```
```{r}
# Calculate the number of differing values in daily_intense
diff <- daily_intense
diff$Id <- ifelse(daily_act$Id != daily_intense$Id, 1, 0)
diff$ActivityDay <- ifelse(daily_act$ActivityDate != daily_intense$ActivityDay, 1, 0)
diff$SedentaryMinutes <- ifelse(daily_act$SedentaryMinutes != daily_intense$SedentaryMinutes, 1, 0)
diff$LightlyActiveMinutes <- ifelse(daily_act$LightlyActiveMinutes != daily_intense$LightlyActiveMinutes, 1, 0)
diff$FairlyActiveMinutes <- ifelse(daily_act$FairlyActiveMinutes != daily_intense$FairlyActiveMinutes, 1, 0)
diff$VeryActiveMinutes <- ifelse(daily_act$VeryActiveMinutes != daily_intense$VeryActiveMinutes, 1, 0)
diff$SedentaryActiveDistance <- ifelse(daily_act$SedentaryActiveDistance != daily_intense$SedentaryActiveDistance, 1, 0)
diff$LightActiveDistance <- ifelse(daily_act$LightActiveDistance != daily_intense$LightActiveDistance, 1, 0)
diff$ModeratelyActiveDistance <- ifelse(daily_act$ModeratelyActiveDistance != daily_intense$ModeratelyActiveDistance, 1, 0)
diff$VeryActiveDistance <- ifelse(daily_act$VeryActiveDistance != daily_intense$VeryActiveDistance, 1, 0)
colSums(diff)
```
```{r}
head(daily_steps)
```
```{r}
colnames(daily_steps)
```
```{r}
# Calculate the number of differing values in daily_steps
diff <- daily_steps
diff$Id <- ifelse(daily_act$Id != daily_steps$Id, 1, 0)
diff$ActivityDay <- ifelse(daily_act$ActivityDate != daily_steps$ActivityDay, 1, 0)
diff$StepTotal <- ifelse(daily_act$TotalSteps != daily_steps$StepTotal, 1, 0)
colSums(diff)
```
```{r}
head(daily_sleep)
```
```{r}
colnames(daily_sleep)
```
```{r}
n_distinct(daily_sleep$Id)
n_distinct(daily_sleep$SleepDay)
table(daily_sleep$SleepDay)
```
```{r}
n_distinct(daily_act$Id)
n_distinct(daily_act$ActivityDate)
unique(daily_act$ActivityDate)
table(daily_act$ActivityDate)
```
With 0 differences in `daily_act` vs these 3 data, the following files can be safely dropped from the analysis:

- `daily_cal`
- `daily_intense`
- `daily_steps`

```{r}
# Remove dataframes from R environment
rm(
  daily_cal,
  daily_intense,
  daily_steps,
  diff # dummy variable
)
```

However, `daily_sleep` is not contained in `daily_act` so it can not be safely dropped. 

- There are only 24 unique IDs meaning it is missing some users.
- Not all sleep days are recorded with equal frequency.

Looking at `daily_act`:

- There are 33 unique IDs corresponding to the individual users - the dataset description only notes 30 users. ~30 users is a small sample size and data may be prone to bias.
- There are 31 unique dates corresponding to 1 month of data from April 12, 2016 - May 12, 2016. This data is 5 years old and may be outdated and unreliable.

Now let's look at the 3 hourly csv files:

- `hourly_cal`
- `hourly_intense`
- `hourly_steps`

```{r}
head(hourly_cal)
```
```{r}
colnames(hourly_cal)
```
```{r}
head(hourly_intense)
```
```{r}
colnames(hourly_intense)
```
```{r}
head(hourly_steps)
```
```{r}
colnames(hourly_steps)
```

These data have already been recorded under a daily metric, so the hourly metric is not needed. Confirming my assumption that the hourly captures per hour observations and isn't too helpful for my particular analysis, I will drop these files.

```{r}
# Remove dataframes from R environment
rm(
  hourly_cal,
  hourly_intense,
  hourly_steps
)
```

To confirm that the minute files are per minute observations similar to the hourly files, let's look at the 8 min files:

- `min_cal_narrow`
- `min_cal_wide`
- `min_intense_narrow`
- `min_intense_wide`
- `min_steps_narrow`
- `min_steps_wide`
- `min_sleep`
- `min_met_narrow`

```{r}
head(min_cal_narrow)
```
```{r}
head(min_cal_wide)
```
```{r}
head(min_intense_narrow)
```
```{r}
head(min_intense_wide)
```
```{r}
head(min_steps_narrow)
```
```{r}
head(min_steps_wide)
```
```{r}
head(min_sleep)
```
```{r}
head(min_met_narrow)
```

Similar to the hourly files, the `min_cal`, `min_intense`, and `min_steps` files are recorded under a per minute metric. This metric is too small of a time interval as there are many observations of 0 intensity or steps. The wide format (`min_cal_wide`, `min_intense_wide`, `min_steps_wide`) is a less desired vs the narrow format (`min_cal_narrow`, `min_intense_narrow`, `min_steps_narrow`) because of the ambiguous column names (calories 00, calories 01, etc).

`min_sleep` also contains an ambiguous `value` column that doesn't explain what data it represents.

`min_met_narrow` records the MET (ratio of working metabolic rate relative to resting metabolic rate) per minute. 1 MET is the energy spent sitting at rest. Because the MET is relative to each user (eg. user 1 has higher resting rate than user 2 but much lower than user 3), this file will be dropped because the variable MET is not standardized and therefore will lead to a biased analysis.

```{r}
# Drop dataframes from R environment
rm(
  min_cal_narrow,
  min_cal_wide,
  min_intense_narrow,
  min_intense_wide,
  min_steps_narrow,
  min_steps_wide,
  min_sleep,
  min_met_narrow
)
```

Now let's look at the 1 second file:

- `sec_heartrate`

```{r}
head(sec_heartrate)
```

`sec_heartrate` records the heart rate (`Value` column) of each user on a couple seconds interval. The data under per seconds metric is too narrow of a time interval to be useful. Although it can be transformed into an average heart rate per hour or per day, I will use the intensity variables in `daily_act` for my analysis instead. Therefore, I will be dropping this file from the analysis.

```{r}
# Remove dataframe from R environment
rm(sec_heartrate)
```

Finally, let's take a look the 1 other file:

- `weight_log`

```{r}
head(weight_log)
```
```{r}
colnames(weight_log)
```
```{r}
n_distinct(weight_log$Id)
n_distinct(weight_log$Fat)
unique(weight_log$Fat)
table(weight_log$Id)
```
This file contains useful data such as the weight, fat, and BMI (Body Mass Index) of the users. However, there are only 2 recorded values in the `Fat` column and it is severely incomplete - only 8 users recorded their weight, of which 2 users represent the majority of the data.

> Recall: The goal of this analysis is to find trends in order to improve Bellabeat's product marking strategy. Their products track user activity, sleep, and stress.

Although having weight and BMI data is useful for general health analyses, none of Bellabeat's products track the user's weight or BMI. Additionally, the sample size data is too small to be useful (only 8/33 users) for general product recommendations. I will have to drop this file from the analysis.

```{r}
# Remove dataframe from R environment
rm(weight_log)
```

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

**2. A description of all data sources used:**

The dataset can be found on Kaggle: [Fitbit Fitness Tracker Data](https://www.kaggle.com/arashnic/fitbit "Fitbit Fitness Tracker Data"), by Mobius under the CC0: Public Domain license.

It contains 18 csv files, 3 in wide format, rest in long:

- Data kept for analysis:

  - 'dailyActivity_merged.csv' as `daily_act`
  - 'sleepDay_merged.csv' as `daily_sleep`
  
- Data dropped from analysis:
  - 'dailyCalories_merged.csv'
  - 'dailyIntensities_merged.csv'
  - 'dailySteps_merged.csv'
  - 'hourlyCalories_merged.csv'
  - 'hourlyIntensities_merged.csv'
  - 'hourlySteps_merged.csv'
  - 'minuteCaloriesNarrow_merged.csv'
  - 'minuteCaloriesWide_merged.csv'
  - 'minuteIntensitiesNarrow_merged.csv'
  - 'minuteIntensitiesWide_merged.csv'
  - 'minuteStepsNarrow_merged.csv'
  - 'minuteStepsWide_merged.csv'
  - 'minuteSleep_merged.csv'
  - 'minuteMETsNarrow_merged.csv'
  - 'heartrate_seconds_merged.csv'
  - 'weightLogInfo.csv'
  
**Credibility: Poor**

- Not reliable. Data is severely incomplete and missing information such that it is not representative of the population.
- Not original. Data source is from a third-party user (not from Fitbit, government, or academic source).
- Somewhat comprehensive. There is enough variety of data to gain some insights in order to give recommendations to Bellabeat but with low confidence.
- Not current. Data collected from April 12, 2016 - May 12, 2016 - 5 years old.
- Has citation. Data was gathered via an Amazon survey from 30 consented Fitbit users. Hosted on Kaggle with usability of 10.0, meeting all of Kaggle's uploading requirements.

</div>

# Process

Now it's time to clean the remaining data. I will continue to use R (instead of spreadsheets or SQL) for data cleaning because of the many useful packages available.

Let's first convert all the column names from pascal case to snake case.

```{r Convert col names to snake case}
# Convert column names into snake case
daily_act <- clean_names(daily_act)
daily_sleep <- clean_names(daily_sleep)
```

I want to take a closer look to see if there's any missing values (NA).

```{r}
head(daily_act)
```

```{r}
skim_without_charts(daily_act)
```
```{r}
head(daily_sleep)
```

```{r}
skim_without_charts(daily_sleep)
```

There are no missing values (NA) in both of the dataframes. With regards to summary statistics (mean, std, quartiles), I will disregard the id columns because these values are all unique identifiers and should not be aggregated.

The date columns are of character (strings) data type and need to be changed into date data type.

```{r}
# Rename to date column
daily_act <- daily_act %>% 
  rename(date=activity_date)

daily_sleep <- daily_sleep %>% 
  rename(date=sleep_day)

# Convert to date data type
daily_act$date <- mdy(daily_act$date)

daily_sleep$date <- as_date(
  mdy_hms(daily_sleep$date)
)
```

```{r}
n_distinct(daily_act$id)
n_distinct(daily_sleep$id)
```

Now that each dataframe is clean, I want to join them together into 1 dataframe. They both share id and date values so I will join on those variables.

> Recall that there are 33 users in `daily_act` but only 24 users in `daily_sleep`.

In an ideal scenario, I would use a full outer join and fill in the missing values, but because `daily_sleep` is missing 9 users, I can not simply fill in with the average sleep time. This is because the dataset is already very small and does not accurately represent the population such that imputing the mean may actually skew possible trends.

For this reason, I will use an inner join. This limits the dataset even further to just 24 users.

```{r}
# Merge dataframes
merged_df <- inner_join(daily_act, daily_sleep, by = c('id', 'date'))
```

```{r}
head(merged_df)
```

```{r}
skim_without_charts(merged_df)
```
```{r}
n_distinct(merged_df$id)
```

`merged_df` looks clean and ready to be analyzed.

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

**3. Documentation of any cleaning or manipulation of data:**

- Used tidyverse (dplyr), janitor, lubridate, and skimr packages.
- Converted all column names from pascal case to camel case.
- Renamed 'activity_date' and 'sleep_day' columns in `daily_act` and `daily_sleep`, respectively, to 'date'.
- Converted 'date' columns in `daily_act` and `daily_sleep` from character (string) data type to date data type.

- `daily_act` has no missing (NA) values.
- `daily_sleep` has no missing (NA) values.

- Merged `daily_act` and `daily_sleep` into `merged_df` using an inner join.

</div>

# Analyze

## Calculations

Let's take a closer look into `merged_df`.

```{r}
head(merged_df)
```

```{r}
# Add day of the week column
day_of_week <- wday(merged_df$date, label=TRUE)
merged_df <- add_column(merged_df, day_of_week, .after='date')
```

```{r}
# Check if tracker_distance and total_distance are the same columns
sum(ifelse(merged_df$total_distance != merged_df$tracker_distance, 1, 0))
```
```{r}
merged_df %>% 
  filter(total_distance != tracker_distance)
```
It looks like tracker_distance has the same values as total_distance except for 3 rows (0.7% difference), of which come from the same user. I think I can safely drop tracker_distance and use total_distance instead.

```{r}
# Check logged_activities_distance values
n_distinct(merged_df$logged_activities_distance)
table(merged_df$logged_activities_distance)
```

```{r}
subset(merged_df, logged_activities_distance %in% c(
  2.0921471118927,
  2.25308108329773,
  2.78517508506775,
  3.16782188415527,
  4.08169221878052
))
```

So it looks like the majority of logged_activities_distance values were never recorded. The only values, other than 0, are from 2 users. 

From user id=8378563200, the value=2.0921471118927 was recorded 10 times, and the value=2.25308108329773 was recorded 7 times. I suspect that logged_activities_distance represents manual recordings by the user because it is easier to believe that the user inputted the same distance rather than the user totaling the exact same distance 10 and 7 times across different days.

With no actual context (besides suspicion) and the majority of values equaling 0 (95% value=0), I will drop this column as well.

```{r}
n_distinct(merged_df$sedentary_active_distance)
table(merged_df$sedentary_active_distance)
```

Similarly, sedentary_active_distance has a majority of 0 values (98.5% value=0). This result makes sense because if you are sedentary (mostly sitting as opposed to walking or running), you won't be covering much distance if at all. So the non-zero values are actually the outliers here and are maybe due to rolling around during sleep.

Because of this, I can also safely drop this column as well.

Now, I want to figure out what total_sleep_records is supposed to represent.

```{r}
n_distinct(merged_df$total_sleep_records)
table(merged_df$total_sleep_records)
```

I'm not sure how useful total_sleep_records is as 88.8% are 1, 10% are 2, and 0.72% are 3. The majority of the observations are 1 sleep record, which I can only assume as to mean that most users did not wake up in the middle of the night, and some had to wake up to use the bathroom. This doesn't provide any interesting information, so I will drop this column.

```{r}
# Drop tracker_distance, logged_activities_distance, sedentary_active_distance, total_sleep_records
merged_df <- merged_df %>% 
  select(-c(
    tracker_distance, 
    logged_activities_distance,
    sedentary_active_distance,
    total_sleep_records))

head(merged_df)
```

Because most people often talk about how many hours they have slept as opposed to how many minutes, I will add new columns for sleep hours and use those instead.

```{r}
# Convert sleep time from minutes to hours
merged_df <- merged_df %>% 
  mutate(
    sleep_hours = total_minutes_asleep / 60,
    in_bed_hours = total_time_in_bed / 60) %>% 
  select(-c(total_minutes_asleep, total_time_in_bed))

head(merged_df)
```

To finish off formatting the data, I want to rename all the columns into more meaningful names.

```{r}
merged_df <- merged_df %>% 
  rename(steps = total_steps,
         distance = total_distance,
         sprint_distance = very_active_distance,
         jog_distance = moderately_active_distance,
         walk_distance = light_active_distance,
         sprint_minutes = very_active_minutes,
         jog_minutes = fairly_active_minutes,
         walk_minutes = lightly_active_minutes)

head(merged_df)
```

Okay, now it's time to start analyzing and answer one of my main questions:

**1. What are some trends in smart device usage?**

```{r}
# Average steps taken per day
avg_steps <- merged_df %>% 
  group_by(day_of_week) %>% 
  summarise(average_steps = round(mean(steps)))

avg_steps <- arrange(avg_steps, average_steps)

avg_steps
```

```{r}
# Average distance covered per day
avg_dist <- merged_df %>% 
  group_by(day_of_week) %>% 
  summarise(average_distance = round(mean(distance), 2))

avg_dist <- arrange(avg_dist, average_distance)
            
avg_dist
```

```{r}
# Average calories burned per day
avg_cal <- merged_df %>% 
  group_by(day_of_week) %>% 
  summarise(average_calories = round(mean(calories)))

avg_cal <- arrange(avg_cal, average_calories)

avg_cal
```

From these 3 calculations, on average, Sunday is the least active day and Saturday is the most active day. This would make sense because Saturday is the start of the weekend, and people have more free time to exercise or go out for drinks and socialize. Sunday, on the other hand, could be due to "lazy Sundays" in which people tend to not be as active and stay indoors to relax.

```{r}
# Average hours slept per day
avg_sleep <- merged_df %>% 
  group_by(day_of_week) %>% 
  summarise(average_sleep_hours = round(mean(sleep_hours), 2))

avg_sleep <- arrange(avg_sleep, desc(average_sleep_hours))

avg_sleep
```

As suspected, Sunday has the most average hours slept. Interestingly enough, Wednesday has the 2nd most average hours slept. This could maybe be accredited to Wednesday's "hump day" in which people tend to feel tired and sluggish during the middle of the work week.

## Plots

Let's plot steps, distance, and calories vs day_of_week so that the data is viewed visually.

```{r}
# Steps vs day of the week
steps_per_day_plot <- ggplot(data = merged_df) + 
  geom_boxplot(mapping = aes(x=day_of_week, y=steps, color=day_of_week), notch=TRUE) +
  scale_y_continuous(label = comma, n.breaks = 10)
  
steps_per_day_plot
```

```{r}
# Distance vs day of the week
dist_per_day_plot <- ggplot(data = merged_df) + 
  geom_boxplot(mapping = aes(x=day_of_week, y=distance, color=day_of_week), notch=TRUE) + 
  scale_y_continuous(n.breaks = 10)

dist_per_day_plot
```

```{r}
cal_per_day_plot <- ggplot(data = merged_df) + 
  geom_boxplot(mapping = aes(x=day_of_week, y=calories, color=day_of_week), notch=TRUE) + 
  scale_y_continuous(label=comma, n.breaks = 10)

cal_per_day_plot
```

From these plots, Sunday and Saturday are indeed the least active and most active days of the week. However, when looking at the calories burned plot, most of the notches overlap meaning that although Sunday is the least active day and Saturday the most active day, in terms of calories burned, they are not statistically significant enough.

Let's take a look at sleep_hours vs day_of_week.

```{r}
sleep_per_day_plot <- ggplot(data = merged_df) + 
  geom_boxplot(mapping = aes(x=day_of_week, y=sleep_hours, color=day_of_week)) + 
  scale_y_continuous(n.breaks = 6)

sleep_per_day_plot
```

As expected, the median hours of sleep per day is about 7 hours, except for Sunday for which its median is 8 hours (though a 1 hour difference is not statistically significant). This plot further supports the idea of "lazy Sundays." Saturday and Sunday also have the largest range of values (ie. largest boxes) which can correspond with people's weekend plans which can vary widely between users. Contrasting this with Monday to Friday, the "work days" have much smaller boxes meaning the users mostly slept on a consistent schedule.

Let's take a look at sleep_hours vs in_bed_hours.

```{r}
bed_sleep_plot <- ggplot(data = merged_df) +
  geom_point(mapping = aes(x=in_bed_hours, y=sleep_hours)) + 
  geom_smooth(mapping = aes(x=in_bed_hours, y=sleep_hours)) +
  scale_x_continuous(n.breaks = 10) +
  scale_y_continuous(n.breaks = 8)

bed_sleep_plot
```

Overall, this plot is consistent with the fact that most of the time spent asleep is about the same as the time spent in bed. There are a couple of outliers in which some users were unable to sleep causing them to have a lower sleep_hours to in_bed_hours ratio.

Now let's try to figure out why calories burned isn't statistically significant for Sunday and Saturday.

```{r}
steps_plot <- ggplot(data=merged_df) + 
  geom_point(mapping = aes(x=steps, y=calories)) + 
  geom_smooth(mapping = aes(x=steps, y=calories)) + 
  scale_x_continuous(label=comma, n.breaks = 10) +
  scale_y_continuous(label=comma)

dist_plot <- ggplot(data=merged_df) + 
  geom_point(mapping = aes(x=distance, y=calories)) + 
  geom_smooth(mapping = aes(x=distance, y=calories)) + 
  scale_x_continuous(n.breaks = 10) +
  scale_y_continuous(label=comma)

steps_plot / dist_plot
```

Comparing calories vs steps, there seems to be a general trend that more steps mean more calories burned. But the range of values for each step value is quite large (eg. at 10,000 total steps, calories burned ranges from 1500 to 3500), so much so that the best fit line is a little misleading and inaccurate. Similarly, calories vs distance has this same general trend but is also too inaccurate.

Let's compare the intensities distance (sprint_distance, jog_distance, walk_distance) vs calories.

```{r}
sprint_dist_plot <- ggplot(data = merged_df) + 
  geom_point(mapping = aes(x=sprint_distance, y=calories)) + 
  geom_smooth(mapping = aes(x=sprint_distance, y=calories)) +
  scale_x_continuous(n.breaks=10) +
  scale_y_continuous(label=comma)

jog_dist_plot <- ggplot(data = merged_df) + 
  geom_point(mapping = aes(x=jog_distance, y=calories)) +
  geom_smooth(mapping = aes(x=jog_distance, y=calories)) +
  scale_x_continuous(n.breaks=10) +
  scale_y_continuous(label=comma)

walk_dist_plot <- ggplot(data = merged_df) + 
  geom_point(mapping = aes(x=walk_distance, y=calories)) + 
  geom_smooth(mapping = aes(x=walk_distance, y=calories)) +
  scale_x_continuous(n.breaks=10) +
  scale_y_continuous(label=comma)

(sprint_dist_plot | jog_dist_plot) / walk_dist_plot
```

It's clear from these plots that walk_distance is the only one with a positive correlation with calories (calories increase as walk_distance increases). Both sprint_distance and jog_distance start off with a positive slope (ie. positive correlation) but jog_distance becomes negative close to 1, whereas sprint_distance is negative until after 2 then starts it is positive again.

Translating to what this actually means, all 3 types of intensities initially burn calories. However, walking is the only one that burns calories at an increasing rate as the user walks for a farther distance. Jogging actually burns less calories at longer distances, and sprinting does burn calories at an increasing rate only if it is sustained (which goes against the whole point of sprinting "high energy for short distance").

With this in mind, I now want to look at intensity duration (sprint_minutes, jog_minutes, walk_minutes, sedentary_minutes) vs calories.

```{r}
ggplot(data = merged_df) + 
  geom_point(mapping = aes(x=sedentary_minutes, y=calories)) + 
  geom_smooth(mapping = aes(x=sedentary_minutes, y=calories)) +
  scale_x_continuous(label=comma, n.breaks = 10) +
  scale_y_continuous(label=comma)
```

Again, the best fit line is inaccurate given the data because there is a wide range of values from 500-1000 sedentary minutes. It is difficult to conclude if sedentary_minutes correlate with calories, but you still burn a base number of calories even while sitting down - the 1 MET.


```{r}
sprint_min_plot <- ggplot(data = merged_df) + 
  geom_point(mapping = aes(x=sprint_minutes, y=calories)) + 
  geom_smooth(mapping = aes(x=sprint_minutes, y=calories)) +
  scale_x_continuous(n.breaks = 10) +
  scale_y_continuous(label=comma)

jog_min_plot <- ggplot(data = merged_df) + 
  geom_point(mapping = aes(x=jog_minutes, y=calories)) +
  geom_smooth(mapping = aes(x=jog_minutes, y=calories)) +
  scale_x_continuous(n.breaks = 10) +
  scale_y_continuous(label=comma)

walk_min_plot <- ggplot(data = merged_df) + 
  geom_point(mapping = aes(x=walk_minutes, y=calories)) + 
  geom_smooth(mapping = aes(x=walk_minutes, y=calories)) +
  scale_x_continuous(n.breaks = 10) +
  scale_y_continuous(label=comma)

(sprint_min_plot | jog_min_plot) / walk_min_plot
```

These plots follow the exact same trend as the intensities distance (sprint_distance, jog_distance, walk_distance). All of them initially burn calories at an increasing rate, but only continually walking burns calories at an increasing rate. Jogging for a longer time actually decreases calories burned, and sprinting for a longer time is projected to burn a lot of calories - but again, sprints are not meant to be performed for a  long duration.

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

**4. A summary of your analysis**

Drop columns:

- tracker_distance
  - Identical to total_distance, except for 3 rows (0.7% difference).
- logged_activities_distance
  - 95% of values equal 0.
  - Remaining values recorded by 2 users.
- sedentary_active_distance 
  - 98.5% of values equal 0. 
  - Sedentary (mostly sitting as opposed to walking or running) won't be covering much distance if at all.
- total_sleep_records
  - 88.8% are 1, 10% are 2, and 0.72% are 3. 
  - The majority of the observations are 1 sleep record (ie. did not wake up during the middle of the night).
  
Add columns:

- day_of_week
  - Convert date to the day of the week.
- sleep_hours
  - Convert total_minutes_asleep to hours slept.
- in_bed_hours
  - Convert total_time_in_bed to hours in bed.

**Main Question 1. What are some trends in smart device usage?**

Trends:

- Sunday is the least active day.
  - Lowest average steps and distance.
  - Highest average and median number of hours slept.
  - "Lazy Sunday": relax indoors.
- Saturday is the most active day.
  - Highest average steps and distance.
  - Lowest average and median number of hours slept.
  - Free time on Saturday to exercise, go out and have drinks, and socialize.
- Wednesday is the 2nd most hours slept day.
  - "Hump Day": mid-work week tiredness and slump.
  
- Users slept more consistently on the weekdays and less consistently on the weekends.
- Users did not have any trouble sleeping.
  - in_bed_hours about the same as sleep_hours.
  
- Walking burns more calories than jogging or sprinting when performed for a longer duration or farther distance.

</div>

# Share

It's time to present these findings to the stakeholders: Bellabeat's cofounders, Urška Sršen and Sando Mur, and the Bellabeat marketing analytics team. I will need to clean up and annotate the plots so that they are easily readable.

```{r}
# Compute medians
step_median <- merged_df %>% 
  group_by(day_of_week) %>% 
  summarise(steps_median = median(steps))

# Steps vs day of the week plot
steps_per_day_plot <- steps_per_day_plot +
  # Labels
  theme(legend.position = "none") +
  labs(title = "Median Steps Taken For Each Day of the Week", 
       x = "Day",
       y = "Steps",
       colour = "Day of the Week") +
  # Annotate median values
  geom_text(data = step_median,
            aes(x=day_of_week, y=steps_median, label=comma(steps_median)),
            position = position_nudge(y=1000)) 
  # Add average table
  # annotate("table", x=37, y=-0.8, label=list(avg_steps), vjust=1, hjust=0)

steps_per_day_plot
```

```{r}
# Compute medians
dist_median <- merged_df %>% 
  group_by(day_of_week) %>% 
  summarise(distance_median = round(median(distance), 2))

# Distance vs day of the week plot
dist_per_day_plot <- dist_per_day_plot +
  # Labels
  theme(legend.position = "none") +
  labs(title = "Median Distance Traveled For Each Day of the Week",
       x = "Day",
       y = "Distance",
       colour = "Day of the Week") +
  # Annotate median values
  geom_text(data = dist_median,
            aes(x=day_of_week, y=distance_median, label=distance_median),
            position = position_nudge(y=0.66))

dist_per_day_plot
```

```{r}
# Compute medians
cal_median <- merged_df %>% 
  group_by(day_of_week) %>% 
  summarise(calories_median = median(calories))

# Calories vs day of the week plot
cal_per_day_plot <- cal_per_day_plot +
  # Labels
  theme(legend.position = "none") +
  labs(title = "Median Calories Burned For Each Day of the Week",
       x = "Day",
       y = "Calories",
       colour = "Day of the Week") +
  # Annotate median values
  geom_text(data = cal_median,
            aes(x=day_of_week, y=calories_median, label=comma(calories_median)),
            position = position_nudge(y=200))

cal_per_day_plot
```

```{r}
# Compute medians
sleep_hour_median <- merged_df %>% 
  group_by(day_of_week) %>% 
  summarise(sleep_median = round(median(sleep_hours), 1))

# Sleep hours vs day of the week plot
sleep_per_day_plot <- sleep_per_day_plot +
  # Labels
  theme(legend.position = "none") +
  labs(title = "Median Hours Slept For Each Day of the Week",
       x = "Day",
       y = "Hours",
       colour = "Day of the Week") +
  # Annotate median values
  geom_text(data = sleep_hour_median,
            aes(x=day_of_week, y=sleep_median, label=sleep_median),
            position = position_nudge(y=0.3))

sleep_per_day_plot
```

```{r}
# Hours slept vs hours in bed
bed_sleep_plot <- bed_sleep_plot +
  # Labels
  labs(title = "Did Users Have Trouble Falling Asleep?",
       subtitle = "Hours slept vs hours in bed",
       x = "Hours in Bed",
       y = "Hours Slept") +
  # Annotate cannot sleep by 1 hour
  annotate("segment", x=2, xend=13, y=1, yend=12, colour="red", size=1.5) +
  annotate("text", x=9, y=4, label="Cannot sleep for more than 1 hour", 
           color="red", size=5, fontface="bold", angle=30)

bed_sleep_plot
```

```{r}
sprint_dist_plot <- sprint_dist_plot + 
  labs(x="Sprinting Distance", y="Calories")

jog_dist_plot <- jog_dist_plot +
  labs(x="Jogging Distance", y="Calories")

walk_dist_plot <- walk_dist_plot +
  labs(x="Walking Distance", y="Calories")

((sprint_dist_plot | jog_dist_plot) / walk_dist_plot) +
  plot_annotation(title="Calories Burned vs Distance Traveled at Various Intensities",
                  subtitle="Note: High energy sprints are difficult to maintain for long distances")
```

```{r}
sprint_min_plot <- sprint_min_plot + 
  labs(x="Sprinting Minutes", y="Calories")

jog_min_plot <- jog_min_plot +
  labs(x="Jogging Minutes", y="Calories")

walk_min_plot <- walk_min_plot +
  labs(x="Walking Minutes", y="Calories")

((sprint_min_plot | jog_min_plot) / walk_min_plot) +
  plot_annotation(title="Calories Burned vs Duration at Various Intensities",
                  subtitle="Note: High energy sprints are difficult to maintain for long duration")
```

The visualizations are cleaned and ready to be presented. What do these plots tell about the Fitbit users' health and habits?

Looking at "Median Steps Taken For Each Day of the Week," "Median Distance Traveled For Each Day of the Week," and "Median Calories Burned For Each Day of the Week" plots, Sundays are the least active day and Saturdays are the most active day for most users. 

Looking at "Median Hours Slept For Each Day of the Week," Wednesday is the 2nd most hours slept day of the week. Wednesday is also known as "Hump Day" a reference to a camel's hump in which Wednesday is typically the most stressful day and one has to climb this hill (hump) to get through the work week.

"Median Hours Slept For Each Day of the Week" shows that users sleep more consistently on the weekdays than on the weekends.

"Did Users Have Trouble Falling Asleep?" shows that most users fell asleep within 1 hour of being in bed. There are a couple instances in which users could not sleep for more than 1 hour but are quite few compared to those who slept within an hour.

Looking at "Calories Burned vs Distance Traveled at Various Intensities" and "Calories Burned vs Duration at Various Intensities" all 3 intensity levels initially burn calories at an increasing rate. However, jogging is shown to burn calories at a decreasing rate as the distance or duration increases. Sprinting does burn calories at an increasing rate only if it is performed for a long enough distance or duration, but that is very difficult to realistically maintain; so, sprinting should be kept at short distances and duration. Walking is the only intensity shown to burn calories at an increasing rate as the distance or duration increases.

I will now answer the second main question:

**2. How could these trends apply to Bellabeat customers?**

Bellabeat is a high-tech company that manufactures health-focused smart products for women. Its mission statement is to empower women with knowledge about their own health and habits by collecting data on activity, sleep, stress, and reproductive health.

I conclude that most Bellabeat customers are:

- Women
- Conscious or interested about their health and habits
- Want to improve their health and lifestyle
- Familiar with smart devices

So although these are Fitbit specific trends, Fitbit is not so different from Bellabeat and most likely share some of the same clientele. 

These trends:

- Show common habits.
- Explain a way to improve one's lifestyle.
- Were extrapolated from smart device data.

<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

**5. Supporting visualizations and key findings**

See above for supporting visualizations.

Key Findings:

- "Median Steps Taken For Each Day of the Week," "Median Distance Traveled For Each Day of the Week," and "Median Calories Burned For Each Day of the Week" plots:
  - Sundays are the least active day.
  - Saturdays are the most active day.

- "Median Hours Slept For Each Day of the Week":
  - Wednesday is the 2nd most hours slept day of the week. 
  - It is also known as "Hump Day," a reference to a camel's hump in which Wednesday is typically the most stressful day and one has to climb this hill (hump) to get through the work week.

- "Median Hours Slept For Each Day of the Week":
  - Users sleep more consistently on the weekdays than on the weekends.
  - Ideal to have consistent sleep schedule throughout the entire week.

- "Did Users Have Trouble Falling Asleep?":
  - Most users fell asleep within 1 hour of being in bed. 
  - A couple instances in which users could not sleep for more than 1 hour but are quite few.

- "Calories Burned vs Distance Traveled at Various Intensities" and "Calories Burned vs Duration at Various Intensities":
  - All 3 intensity levels initially burn calories at an increasing rate. 
  - Jogging is shown to burn calories at a decreasing rate as the distance or duration increases. 
  - Sprinting does burn calories at an increasing rate only if it is performed for a long enough distance or duration.
    - Very difficult to realistically maintain.
    - Sprinting should be kept at short distances and duration.
  - Walking is the only intensity shown to burn calories at an increasing rate as the distance or duration increases.

**Main Question 2. How could these trends apply to Bellabeat customers?**

Most Bellabeat customers are:

- Women
- Conscious or interested about their health and habits
- Want to improve their health and lifestyle
- Familiar with smart devices

These trends:

- Show common habits.
- Explain a way to improve one's lifestyle.
- Were extrapolated from smart device data.

</div>

# Act

Now that I have presented my findings and how they relate to Bellabeat customers, I will give my recommendations to improve the Bellabeat app as it is the main product that all customers interface with. The Bellabeat app tracks user activity, sleep, stress, menstrual cycle, and mindfulness habits.

The Fitbit data did not contain any information regarding menstrual cycles, so I have no recommendations for that particular subject.

Activity:

Looking at "Calories Burned vs Distance Traveled at Various Intensities" and "Calories Burned vs Duration at Various Intensities" all 3 intensity levels initially burn calories at an increasing rate. However, jogging is shown to burn calories at a decreasing rate as the distance or duration increases. Sprinting does burn calories at an increasing rate only if it is performed for a long enough distance or duration, but that is very difficult to realistically maintain. Walking is the only intensity shown to burn calories at an increasing rate as the distance or duration increases.

Recommendation: Keep steps data as a useful metric, but do not emphasize it as there is no strong correlation that putting in more steps burns more calories - it depends on the intensity of those steps. Emphasize and track data for walking and sprinting, depending on the user's time constraint. If the user inputs limited time (eg. at work), then recommend performing some short-timed sprints. If the user inputs a lot of free time (eg. at home on the weekend), then recommend taking a long walk.


Sleep:

Looking at "Did Users Have Trouble Falling Asleep?" plot, most users fell asleep within 1 hour of being in bed. There are a couple instances in which users could not sleep for more than 1 hour, but are quite few compared to those who slept within an hour. Because of this, there is no need to add any sleep aids.

Stress:

Looking at "Median Hours Slept For Each Day of the Week," Wednesday is the 2nd most hours slept day of the week. Wednesday is also known as "Hump Day" a reference to a camel's hump in which Wednesday is typically the most stressful day and one has to climb this hill (hump) to get through the work week.

Recommendations: Throughout Wednesday, send words of affirmation notifications to users to help them de-stress and keep pushing forward.

Menstrual cycles:

The Fitbit data did not contain any information regarding menstrual cycles, so I have no recommendations for that particular subject.

Mindfulness habits:


Looking at "Median Steps Taken For Each Day of the Week," "Median Distance Traveled For Each Day of the Week," and "Median Calories Burned For Each Day of the Week" plots, Sundays are the least active day and Saturdays are the most active day for most users. Also "Median Hours Slept For Each Day of the Week" shows that users sleep more consistently on the weekdays than on the weekends.

Recommendations:

Encourage users to exercise on Sundays with reminder notifications.

Encourage users to keep exercising on Saturdays with a scorecard and giving out rewards to users who keep it up consecutive weeks.

Track sleep and aggregate them for weekdays vs weekends and send reminder notifications that it is ideal to have a consistent sleep schedule.



<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

**6. Your top high-level content recommendations based on your analysis**

Improve 






</div>